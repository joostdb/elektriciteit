<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Eendraadschema Tekenaar</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background-color: #f0f2f5;
        }
        #toolbox {
            width: 250px;
            background: #ffffff;
            padding: 10px;
            border-right: 1px solid #d1d5db;
            overflow-y: auto;
            box-shadow: 1px 0 3px rgba(0,0,0,0.1);
        }
        .tool-section {
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 10px;
        }
        .tool-section h3 {
            margin: 0 0 12px 0;
            font-size: 15px;
            color: #374151;
            font-weight: 600;
        }
        .symbol {
            padding: 10px;
            background: #ffffff;
            border: 1px solid #d1d5db;
            margin-bottom: 8px;
            cursor: pointer;
            text-align: center;
            border-radius: 6px;
            user-select: none;
            transition: all 0.2s;
            font-size: 14px;
        }
        .symbol:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }
        .symbol.active {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }
        #canvas-container {
            flex: 1;
            position: relative;
            overflow: auto;
            background: #ffffff;
        }
        canvas {
            display: block;
            background: #ffffff;
            cursor: crosshair;
        }
        #status-bar {
            position: fixed;
            bottom: 0;
            left: 250px;
            right: 0;
            background: #1f2937;
            color: #f9fafb;
            padding: 8px 15px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #toolbar {
            position: absolute;
            top: 10px;
            left: 270px;
            background: white;
            border-radius: 6px;
            padding: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
            display: flex;
            gap: 5px;
        }
        .toolbar-btn {
            padding: 5px 10px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        .toolbar-btn:hover {
            background: #e5e7eb;
        }
        .toolbar-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #2563eb;
        }
        .custom-components {
            margin-top: 20px;
        }
        #new-component-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 5px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
        }
        #add-component-btn {
            width: 100%;
            padding: 8px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #add-component-btn:hover {
            background: #2563eb;
        }
        .phase-L1 { color: #a0522d; }
        .phase-L2 { color: #000000; }
        .phase-L3 { color: #808080; }
        .phase-N { color: #0000ff; }
        .phase-PE { color: #ff0; background: #333; padding: 2px; }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div id="toolbox">
        <div class="tool-section">
            <h3>Tools</h3>
            <div class="symbol active" data-type="select">Selecteren</div>
            <div class="symbol" data-type="wire">Draad tekenen</div>
            <div class="symbol" data-type="delete">Verwijderen</div>
        </div>
        
        <div class="tool-section">
            <h3>Componenten</h3>
            <div class="symbol" data-type="lamp">Lamp</div>
            <div class="symbol" data-type="switch">Schakelaar</div>
            <div class="symbol" data-type="socket">Stopcontact</div>
            <div class="symbol" data-type="breaker">Automaat</div>
            <div class="symbol" data-type="resistor">Weerstand</div>
        </div>
        
        <div class="tool-section">
            <h3>Fasenaanduiding</h3>
            <div class="symbol phase-L1" data-type="phase-L1">Fase L1 (bruin)</div>
            <div class="symbol phase-L2" data-type="phase-L2">Fase L2 (zwart)</div>
            <div class="symbol phase-L3" data-type="phase-L3">Fase L3 (grijs)</div>
            <div class="symbol phase-N" data-type="phase-N">Nul (blauw)</div>
            <div class="symbol phase-PE" data-type="phase-PE">Aarde (geel/groen)</div>
        </div>

        <div class="tool-section custom-components">
            <h3>Aangepaste Componenten</h3>
            <input type="text" id="new-component-input" placeholder="Nieuwe component naam">
            <button id="add-component-btn">Toevoegen</button>
            <div id="custom-components-list"></div>
        </div>
    </div>

    <div id="canvas-container">
        <div id="toolbar">
            <button id="btn-zoom-in" class="toolbar-btn">+</button>
            <button id="btn-zoom-out" class="toolbar-btn">-</button>
            <button id="btn-zoom-fit" class="toolbar-btn">Passend maken</button>
            <button id="btn-save" class="toolbar-btn">Opslaan</button>
            <button id="btn-load" class="toolbar-btn">Laden</button>
            <button id="btn-print" class="toolbar-btn">Afdrukken</button>
        </div>
        <canvas id="schemaCanvas" width="3000" height="3000"></canvas>
    </div>

    <div id="status-bar">
        <div id="status-message">Klaar</div>
        <div id="coordinates">X: 0 | Y: 0 | Schaal: 100%</div>
    </div>

    <script>
    $(document).ready(function() {
        const canvas = $('#schemaCanvas')[0];
        const ctx = canvas.getContext('2d');
        const statusMessage = $('#status-message');
        const coordinatesDisplay = $('#coordinates');

        // Configuratie
        const gridSize = 20;
        const snapTolerance = 10;
        const minScale = 0.2;
        const maxScale = 3.0;

        // Applicatiestatus
        let elements = [];
        let wires = [];
        let customComponents = [];
        let selectedTool = 'select';
        let selectedElement = null;
        let isDrawingWire = false;
        let currentWire = null;
        let mousePos = { x: 0, y: 0 };
        let scale = 1.0;
        let offset = { x: 0, y: 0 };
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };

        // Initialisatie
        function init() {
            setupEventListeners();
            loadCustomComponents();
            drawGrid();
            updateStatusBar();
        }

        // Event listeners
        function setupEventListeners() {
            $('.symbol').on('click', function() {
                $('.symbol').removeClass('active');
                $(this).addClass('active');
                selectedTool = $(this).data('type');
                updateStatusMessage();
            });

            $('#add-component-btn').click(addCustomComponent);
            $('#btn-zoom-in').click(() => zoom(1.2));
            $('#btn-zoom-out').click(() => zoom(0.8));
            $('#btn-zoom-fit').click(zoomToFit);
            $('#btn-save').click(saveProject);
            $('#btn-load').click(loadProject);
            $('#btn-print').click(printCanvas);

            $(canvas).on({
                mousedown: handleMouseDown,
                mousemove: handleMouseMove,
                mouseup: handleMouseUp,
                mouseleave: handleMouseLeave,
                contextmenu: e => e.preventDefault(),
                wheel: handleWheel
            });

            $(document).keydown(handleKeyDown);
        }

        // Aangepaste componenten
        function addCustomComponent() {
            const componentName = $('#new-component-input').val().trim();
            if (!componentName) return alert('Voer een naam in');
            
            if (customComponents.some(c => c.name.toLowerCase() === componentName.toLowerCase())) {
                return alert('Component bestaat al!');
            }

            const newComponent = {
                name: componentName,
                type: 'custom-' + Date.now()
            };

            customComponents.push(newComponent);
            $('#new-component-input').val('');
            updateCustomComponentsList();
            saveCustomComponents();
        }

        function updateCustomComponentsList() {
            $('#custom-components-list').empty();
            customComponents.forEach(component => {
                $('<div>')
                    .addClass('symbol')
                    .attr('data-type', component.type)
                    .text(component.name)
                    .appendTo('#custom-components-list');
            });
        }

        function saveCustomComponents() {
            localStorage.setItem('customComponents', JSON.stringify(customComponents));
        }

        function loadCustomComponents() {
            const saved = localStorage.getItem('customComponents');
            if (saved) {
                customComponents = JSON.parse(saved);
                updateCustomComponentsList();
            }
        }

        // Tekenfuncties
        function drawGrid() {
            ctx.save();
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.restore();

            ctx.save();
            ctx.scale(scale, scale);
            ctx.translate(offset.x, offset.y);

            ctx.strokeStyle = "#e0e0e0";
            ctx.lineWidth = 1;

            const visibleStartX = -offset.x;
            const visibleStartY = -offset.y;
            const visibleEndX = visibleStartX + canvas.width / scale;
            const visibleEndY = visibleStartY + canvas.height / scale;

            for (let x = Math.floor(visibleStartX / gridSize) * gridSize; x < visibleEndX; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, visibleStartY);
                ctx.lineTo(x, visibleEndY);
                ctx.stroke();
            }

            for (let y = Math.floor(visibleStartY / gridSize) * gridSize; y < visibleEndY; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(visibleStartX, y);
                ctx.lineTo(visibleEndX, y);
                ctx.stroke();
            }

            ctx.restore();
        }

        function drawElements() {
            ctx.save();
            ctx.scale(scale, scale);
            ctx.translate(offset.x, offset.y);

            // Draden
            wires.forEach(wire => {
                ctx.beginPath();
                ctx.strokeStyle = getPhaseColor(wire.phase) || '#000';
                ctx.lineWidth = wire.thickness || 2;
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';

                for (let i = 0; i < wire.points.length; i += 2) {
                    const x = wire.points[i];
                    const y = wire.points[i + 1];
                    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                }
                ctx.stroke();
            });

            // Componenten
            elements.forEach(el => {
                ctx.save();
                ctx.translate(el.x, el.y);

                if (selectedElement?.id === el.id) {
                    ctx.strokeStyle = '#3b82f6';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(-15, -15, 30, 30);
                }

                ctx.fillStyle = getPhaseColor(el.phase) || '#000';
                ctx.strokeStyle = getPhaseColor(el.phase) || '#000';
                ctx.lineWidth = 2;

                if (el.type.startsWith('custom')) {
                    ctx.fillStyle = '#3b82f6';
                    ctx.fillRect(-10, -10, 20, 20);
                    ctx.fillStyle = '#fff';
                    ctx.font = '8px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(el.name.substring(0,3), 0, 3);
                } else {
                    switch(el.type) {
                        case 'lamp':
                            ctx.beginPath();
                            ctx.arc(0, 0, 10, 0, Math.PI * 2);
                            ctx.stroke();
                            ctx.moveTo(-10, 0);
                            ctx.lineTo(10, 0);
                            ctx.stroke();
                            break;
                        case 'switch':
                            ctx.beginPath();
                            ctx.moveTo(-10, -5);
                            ctx.lineTo(10, -5);
                            ctx.moveTo(0, -5);
                            ctx.lineTo(0, 10);
                            ctx.stroke();
                            break;
                        case 'socket':
                            ctx.beginPath();
                            ctx.arc(0, 0, 8, 0, Math.PI * 2);
                            ctx.stroke();
                            ctx.fillRect(-2, -8, 4, 8);
                            break;
                        case 'resistor':
                            ctx.beginPath();
                            ctx.moveTo(-10, 0);
                            ctx.lineTo(-5, -5);
                            ctx.lineTo(5, 5);
                            ctx.lineTo(10, 0);
                            ctx.stroke();
                            break;
                        case 'breaker':
                            ctx.strokeRect(-10, -7, 20, 14);
                            ctx.beginPath();
                            ctx.moveTo(0, -7);
                            ctx.lineTo(0, 7);
                            ctx.stroke();
                            break;
                    }
                }

                ctx.restore();
            });

            ctx.restore();
        }

        // Overige functies (handleMouse*, zoom, snapToGrid, save/load, etc.)
        // ... [De rest van de functies zoals eerder beschreven] ...

        init();
    });
    </script>
</body>
</html>
